# Custom build-pipeline-config ConfigMap
# Replaces Konflux default pipelines with custom SLSA pipeline (slsa-e2e-oci-ta)
#
# Usage:
#   ./scripts/patch-pipeline-config.sh
#
# NOTE: This ConfigMap is managed by the Konflux operator. The patch script takes
# ownership away from the operator using a different field-manager to prevent
# automatic reconciliation. This file defines the desired configuration.

apiVersion: v1
kind: ConfigMap
metadata:
  name: build-pipeline-config
  namespace: build-service
data:
  config.yaml: |
    default-pipeline-name: slsa-e2e-oci-ta
    pipelines:
    - name: slsa-e2e-oci-ta
      bundle: quay.io/arewm/pipeline-slsa-e2e-oci-ta:latest
      description: "SLSA end-to-end pipeline with configurable security scanners"
      detail: |
        This pipeline demonstrates SLSA compliance with trusted artifacts and configurable security scanning.

        The pipeline uses OCI artifacts for data sharing instead of PVCs, ensuring trusted task compliance
        for Enterprise Contract policies.
      additional-params:
        - enable-clair-scan
        - enable-trivy-sbom-scan
